<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>计算帖子数量</title>
</head>

<body>

</body>

</html>

<script>

  const posts = [
    { id: 1, title: '第一篇帖子' },
    { id: 2, title: '第二篇帖子' },
    { id: 3, title: '第三篇帖子' }
  ];

  const comments = [
    { id: 101, postId: 1, content: '沙发' },
    { id: 102, postId: 1, content: '板凳' },
    { id: 103, postId: 2, content: '路过' },
    { id: 104, postId: 1, content: '再来一条' }
  ];

  /*
    [
      { id: 1, title: '第一篇帖子', commentCount: 3 },
      { id: 2, title: '第二篇帖子', commentCount: 1 },
      { id: 3, title: '第三篇帖子', commentCount: 0 }
    ]
  */

  function countCommentsByPost(posts, comments) {
    // 1. 先把所有帖子 id 初始化成 0，保证没评论的帖子也是 0
    const countMap = Object.create(null); // 没有原型，少踩坑
    for (const post of posts) {
      countMap[post.id] = 0;
    }

    // 2. 遍历所有评论，按 postId 计数
    for (const comment of comments) {
      const pid = comment.postId;
      // 保险一点，防止有“指向不存在帖子的评论”
      if (countMap[pid] == null) {
        countMap[pid] = 0;
      }
      countMap[pid] += 1;
    }

    // 3. 返回一个新的数组，不改原 posts
    return posts.map(post => ({
      ...post,
      commentCount: countMap[post.id] || 0
    }));
  }

  // 小测试
  const result = countCommentsByPost(posts, comments);
  console.log(result);
</script>
